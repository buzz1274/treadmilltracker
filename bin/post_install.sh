#!/usr/bin/env bash

sleep 10

ENVIRONMENT=$1

docker exec postgres bash -c 'psql -v ON_ERROR_STOP=1 --username "postgres" <<-EOSQL
    CREATE DATABASE "$TREADMILL_TRACKER_DB_NAME";
    CREATE USER "$TREADMILL_TRACKER_DB_USERNAME";
    ALTER DATABASE "$TREADMILL_TRACKER_DB_NAME" OWNER TO "$TREADMILL_TRACKER_DB_USERNAME";
    GRANT ALL PRIVILEGES ON DATABASE "$TREADMILL_TRACKER_DB_NAME" to "$TREADMILL_TRACKER_DB_USERNAME";
    ALTER USER "$TREADMILL_TRACKER_DB_USERNAME" WITH PASSWORD '\''$TREADMILL_TRACKER_DB_PASSWORD'\'';
EOSQL'

if [ "$ENVIRONMENT" == "DEVELOPMENT" ] ; then
    pre-commit install
fi
